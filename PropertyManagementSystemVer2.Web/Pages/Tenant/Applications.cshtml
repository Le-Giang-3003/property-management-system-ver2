@page
@using PropertyManagementSystemVer2.DAL.Enums
@model PropertyManagementSystemVer2.Web.Pages.Tenant.ApplicationsModel
@{
    ViewData["Title"] = "ƒê∆°n ƒëƒÉng k√Ω c·ªßa t√¥i";
}

<div class="mb-20">
    <div class="page-title">ƒê∆°n xin thu√™ c·ªßa b·∫°n</div>
    <div class="page-desc">Theo d√µi tr·∫°ng th√°i c√°c ƒë∆°n ƒëƒÉng k√Ω thu√™ nh√† b·∫°n ƒë√£ g·ª≠i</div>
</div>

<div class="card mb-20">
    <form method="get" id="filterForm" class="filter-bar" style="margin-bottom: 0;">
        <div class="header-search" style="flex: 1; min-width: 200px;">
            <i data-feather="search" style="color: var(--text-muted); width: 14px;"></i>
            <input type="text" name="SearchTerm" value="@Model.SearchTerm" placeholder="T√¨m t√™n BDS..." style="width: 100%; border: none; outline: none; background: transparent; padding-left: 8px;" />
        </div>
        <input type="hidden" name="StatusFilter" id="statusFilter" value="@Model.StatusFilter" />
        <button type="button" class="btn btn-sm @(!Model.StatusFilter.HasValue ? "btn-primary" : "btn-ghost")" onclick="setFilter('')">T·∫•t c·∫£ (@Model.AllApplications.Count)</button>
        <button type="button" class="btn btn-sm @(Model.StatusFilter == ApplicationStatus.Pending ? "btn-primary text-yellow" : "btn-ghost text-yellow")" style="border-color: var(--warning);" onclick="setFilter('Pending')">ƒêang ch·ªù (@Model.AllApplications.Count(a => a.Status == ApplicationStatus.Pending))</button>
        <button type="button" class="btn btn-sm @(Model.StatusFilter == ApplicationStatus.Approved ? "btn-primary text-green" : "btn-ghost text-green")" style="border-color: var(--success);" onclick="setFilter('Approved')">Ch·∫•p nh·∫≠n (@Model.AllApplications.Count(a => a.Status == ApplicationStatus.Approved))</button>
        <button type="button" class="btn btn-sm @(Model.StatusFilter == ApplicationStatus.Rejected ? "btn-primary text-red" : "btn-ghost text-red")" style="border-color: var(--danger);" onclick="setFilter('Rejected')">T·ª´ ch·ªëi (@Model.AllApplications.Count(a => a.Status == ApplicationStatus.Rejected))</button>
    </form>
</div>

<div class="property-grid">
    @if (Model.Applications != null && Model.Applications.Any())
    {
        foreach (var app in Model.Applications)
        {
            <div class="property-card" style="position: relative;">
                @if (!string.IsNullOrEmpty(app.PropertyThumbnail))
                {
                    <img class="property-image" src="@app.PropertyThumbnail" alt="@app.PropertyTitle" />
                }
                else
                {
                    <div class="property-image-placeholder">üè†</div>
                }
                <div class="property-body">
                    <div style="display: flex; justify-content: space-between; margin-bottom: 6px;">
                        <span class="property-type-badge">ƒê∆°n thu√™</span>
                        @if (app.Status == ApplicationStatus.Pending)
                        {
                            <span class="badge badge-warning">ƒêang x·ª≠ l√Ω</span>
                        }
                        else if (app.Status == ApplicationStatus.Approved)
                        {
                            <span class="badge badge-success">Ch·∫•p nh·∫≠n</span>
                        }
                        else if (app.Status == ApplicationStatus.Rejected)
                        {
                            <span class="badge badge-danger">T·ª´ ch·ªëi</span>
                        }
                        else if (app.Status == ApplicationStatus.Cancelled)
                        {
                            <span class="badge badge-gray">ƒê√£ r√∫t</span>
                        }
                        else
                        {
                            <span class="badge badge-gray">@app.Status</span>
                        }
                    </div>
                    <div class="property-title">@app.PropertyTitle</div>
                    <div style="font-size: 11px; color: var(--text-muted); margin-bottom: 12px;">Ng√†y g·ª≠i: @app.CreatedAt.ToString("dd/MM/yyyy HH:mm")</div>
                    
                    <div class="info-row"><span class="info-label" style="width: 100px;">D·ª± ki·∫øn v√†o</span><span class="info-value">@app.MoveInDate.ToString("dd/MM/yyyy")</span></div>
                    <div class="info-row"><span class="info-label" style="width: 100px;">Th·ªùi h·∫°n</span><span class="info-value">@app.LeaseDurationMonths th√°ng</span></div>
                    <div class="info-row"><span class="info-label" style="width: 100px;">S·ªë ng∆∞·ªùi</span><span class="info-value">@app.NumberOfOccupants ng∆∞·ªùi</span></div>

                    <div style="border-top: 1px solid var(--border); padding-top: 12px; display: flex; align-items: center; justify-content: space-between; margin-top: 12px;">
                        <div>
                            @if (app.Status == ApplicationStatus.Rejected)
                            {
                                <div class="text-red fw-600" style="font-size: 11px; cursor: help;" title="@app.RejectionReason">L√Ω do t·ª´ ch·ªëi...</div>
                            }
                        </div>
                        <div style="display: flex; gap: 6px;">
                            @if (app.Status == ApplicationStatus.Pending)
                            {
                                <form method="post" asp-page-handler="Withdraw" style="margin: 0;">
                                    <input type="hidden" name="applicationId" value="@app.Id" />
                                    <button type="submit" class="btn btn-danger btn-sm" onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën r√∫t ƒë∆°n ƒëƒÉng k√Ω n√†y?');">R√∫t ƒë∆°n</button>
                                </form>
                            }
                            @if (app.Status == ApplicationStatus.Approved)
                            {
                                <div style="font-size: 11px; color: var(--success); font-weight: 600; text-align: right;">ƒê∆°n ƒë√£ ƒë∆∞·ª£c duy·ªát vui l√≤ng qua H·ª£p ƒë·ªìng v√† k√Ω t√™n</div>
                            }
                        </div>
                    </div>
                </div>
            </div>
        }
    }
    else
    {
        <div class="empty-state" style="grid-column: 1 / -1;">
            <div class="empty-icon">inbox</div>
            <p>B·∫°n ch∆∞a g·ª≠i ƒë∆°n ƒëƒÉng k√Ω thu√™ nh√† n√†o. B·∫•m "T√¨m Thu√™ Nh√†" ƒë·ªÉ b·∫Øt ƒë·∫ßu.</p>
            <a href="/Tenant/Search" class="btn btn-primary mt-16">Kh√°m ph√° ngay</a>
        </div>
    }
</div>

@section Scripts {
    <script>
        function setFilter(status) {
            document.getElementById('statusFilter').value = status;
            document.getElementById('filterForm').submit();
        }
    </script>
}
