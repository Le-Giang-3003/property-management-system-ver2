@page
@model PropertyManagementSystemVer2.Web.Pages.Landlord.MaintenanceModel
@{
    ViewData["Title"] = "Qu·∫£n l√Ω B·∫£o tr√¨";
}

<div class="mb-20">
    <div class="page-title">Qu·∫£n l√Ω Y√™u c·∫ßu B·∫£o tr√¨</div>
    <div class="page-desc">Gi·∫£i quy·∫øt c√°c v·∫•n ƒë·ªÅ s·ª≠a ch·ªØa t·ª´ ng∆∞·ªùi thu√™</div>
</div>

<div class="card mb-16" style="padding: 16px;">
    <div class="admin-search-wrapper" style="margin: 0;">
        <i data-feather="search" class="admin-search-icon"></i>
        <input type="text" id="searchInput" class="admin-search-input" placeholder="T√¨m theo t√™n y√™u c·∫ßu, b·∫•t ƒë·ªông s·∫£n..." onkeyup="filterRequests()" />
    </div>
</div>

<div class="filter-bar">
    <button class="btn btn-primary btn-sm filter-btn" data-status="All" onclick="setStatusFilter('All', this)">T·∫•t c·∫£</button>
    <button class="btn btn-ghost btn-sm filter-btn" data-status="InProgress" onclick="setStatusFilter('InProgress', this)">ƒêang x·ª≠ l√Ω</button>
    <button class="btn btn-ghost btn-sm filter-btn" data-status="Open" onclick="setStatusFilter('Open', this)">ƒêang ch·ªù</button>
    <button class="btn btn-ghost btn-sm filter-btn" data-status="Resolved" onclick="setStatusFilter('Resolved', this)">ƒê√£ xong</button>
</div>

<div class="card">
    <div class="table-container">
        <table>
            <thead>
                <tr>
                    <th>TI√äU ƒê·ªÄ / B·∫§T ƒê·ªòNG S·∫¢N</th>
                    <th>NG√ÄY Y√äU C·∫¶U</th>
                    <th>M·ª®C ƒê·ªò</th>
                    <th>DANH M·ª§C</th>
                    <th>TR·∫†NG TH√ÅI</th>
                    <th>H√ÄNH ƒê·ªòNG</th>
                </tr>
            </thead>
            <tbody id="maintenanceTableBody">
                @if (Model.MaintenanceRequests != null && Model.MaintenanceRequests.Any())
                {
                    foreach (var req in Model.MaintenanceRequests)
                    {
                        <tr class="maintenance-row" data-search="@req.Title.ToLower() @req.PropertyTitle.ToLower()" data-status="@req.Status">
                            <td>
                                <div style="display: flex; flex-direction: column; gap: 4px;">
                                    <strong style="font-size: 13px; color: var(--text-primary);">@req.Title</strong>
                                    <span style="font-size: 11px; color: var(--text-muted);">@req.PropertyTitle</span>
                                </div>
                            </td>
                            <td class="text-muted">@req.CreatedAt.ToString("dd/MM/yyyy HH:mm")</td>
                            <td>
                                @if (req.Priority.ToString() == "Urgent" || req.Priority.ToString() == "Critical")
                                {
                                    <span class="badge" style="background: rgba(239, 68, 68, 0.1); color: var(--danger);">Kh·∫©n c·∫•p</span>
                                }
                                else if (req.Priority.ToString() == "High")
                                {
                                    <span class="badge" style="background: rgba(245, 158, 11, 0.1); color: var(--warning);">Cao</span>
                                }
                                else if (req.Priority.ToString() == "Medium")
                                {
                                    <span class="badge badge-info">Trung b√¨nh</span>
                                }
                                else
                                {
                                    <span class="badge badge-success">Th·∫•p</span>
                                }
                            </td>
                            <td>
                                @{
                                    var categoryLabel = req.Category.ToString() switch
                                    {
                                        "Plumbing" => "·ªêng n∆∞·ªõc",
                                        "Electrical" => "ƒêi·ªán",
                                        "Appliance" => "Gia d·ª•ng",
                                        "Structural" => "C·∫•u tr√∫c/X√¢y d·ª±ng",
                                        "Other" => "Kh√°c",
                                        _ => req.Category.ToString()
                                    };
                                }
                                <span class="badge badge-gray">@categoryLabel</span>
                            </td>
                            <td>
                                @if (req.Status.ToString() == "Open")
                                {
                                    <span class="badge badge-warning">ƒêang ch·ªù</span>
                                }
                                else if (req.Status.ToString() == "InProgress")
                                {
                                    <span class="badge badge-info">ƒêang x·ª≠ l√Ω</span>
                                }
                                else if (req.Status.ToString() == "Resolved")
                                {
                                    <span class="badge badge-success">ƒê√£ xong</span>
                                }
                                else if (req.Status.ToString() == "Cancelled")
                                {
                                    <span class="badge badge-danger">ƒê√£ h·ªßy</span>
                                }
                                else
                                {
                                    <span class="badge badge-gray">@req.Status</span>
                                }
                            </td>
                            <td>
                                <div style="display: flex; gap: 4px; align-items: center;">
                                    <button class="btn btn-ghost btn-sm btn-icon" onclick="openDetailModal(@req.Id)" title="Xem chi ti·∫øt" style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center;">
                                        <i data-feather="eye" style="width: 16px;"></i>
                                    </button>
                                    @if (req.Status.ToString() == "Open")
                                    {
                                        <button class="btn btn-ghost btn-sm btn-icon" onclick="openApproveModal(@req.Id, '@Html.Raw(req.Title.Replace("'", "\\'"))')" title="ƒê√£ k√™u th·ª£" style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; color: var(--success);">
                                            <i data-feather="user-check" style="width: 16px;"></i>
                                        </button>
                                        <button class="btn btn-ghost btn-sm btn-icon" onclick="openRejectModal(@req.Id, '@Html.Raw(req.Title.Replace("'", "\\'"))')" title="T·ª´ ch·ªëi" style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; color: var(--danger);">
                                            <i data-feather="x-circle" style="width: 16px;"></i>
                                        </button>
                                    }
                                    @if (req.Status.ToString() == "InProgress")
                                    {
                                        <button class="btn btn-ghost btn-sm btn-icon" onclick="openCompleteModal(@req.Id, '@Html.Raw(req.Title.Replace("'", "\\'"))')" title="Ho√†n th√†nh" style="width: 32px; height: 32px; padding: 0; display: flex; align-items: center; justify-content: center; color: var(--success);">
                                            <i data-feather="check-circle" style="width: 16px;"></i>
                                        </button>
                                    }
                                </div>
                            </td>
                        </tr>
                    }
                }
                else
                {
                    <tr>
                        <td colspan="6">
                            <div class="empty-state">
                                <div class="empty-icon">tool</div>
                                <p>Kh√¥ng c√≥ y√™u c·∫ßu b·∫£o tr√¨ n√†o c·∫ßn x·ª≠ l√Ω ho·∫∑c b·∫°n ch∆∞a c√≥ b·∫•t ƒë·ªông s·∫£n n√†o.</p>
                            </div>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>

@if (Model.MaintenanceRequests != null)
{
    foreach (var req in Model.MaintenanceRequests)
    {
        <!-- DETAIL MODAL -->
        <div id="detailModal-@req.Id" class="modal-overlay" style="display: none;">
            <div class="modal custom-modal" style="width: 680px; max-width: 95vw;">
                <div class="modal-header">
                    <span class="modal-title">
                        <span style="color: var(--text-muted); font-size: 12px; margin-right: 6px;">#@req.Id</span>
                        @req.Title
                    </span>
                    <button class="modal-close btn btn-ghost btn-sm btn-icon" onclick="closeModal('detailModal-@req.Id')">‚úï</button>
                </div>

                <div class="modal-body" style="padding: 20px;">

                    <!-- ‚îÄ‚îÄ Status + Priority + Category badges ‚îÄ‚îÄ -->
                    <div style="display: flex; gap: 8px; flex-wrap: wrap; margin-bottom: 16px;">
                        @if (req.Status.ToString() == "Open")
                        { <span class="badge badge-warning">‚è≥ ƒêang ch·ªù</span> }
                        else if (req.Status.ToString() == "InProgress")
                        { <span class="badge badge-info">üîß ƒêang x·ª≠ l√Ω</span> }
                        else if (req.Status.ToString() == "Resolved")
                        { <span class="badge badge-success">‚úÖ ƒê√£ xong</span> }
                        else if (req.Status.ToString() == "Cancelled")
                        { <span class="badge badge-danger">‚ùå ƒê√£ h·ªßy</span> }

                        @if (req.Priority.ToString() is "Urgent" or "Critical")
                        { <span class="badge" style="background:rgba(239,68,68,.15);color:var(--danger);">üî¥ Kh·∫©n c·∫•p</span> }
                        else if (req.Priority.ToString() == "High")
                        { <span class="badge" style="background:rgba(245,158,11,.15);color:var(--warning);">üü† Cao</span> }
                        else if (req.Priority.ToString() == "Medium")
                        { <span class="badge badge-info">üü° Trung b√¨nh</span> }
                        else
                        { <span class="badge badge-success">üü¢ Th·∫•p</span> }

                        @{
                            var detailCat = req.Category.ToString() switch
                            {
                                "Plumbing"   => "ü™† ·ªêng n∆∞·ªõc",
                                "Electrical" => "‚ö° ƒêi·ªán",
                                "Appliance"  => "üè† Gia d·ª•ng",
                                "Structural" => "üèóÔ∏è C·∫•u tr√∫c",
                                "Painting"   => "üé® S∆°n",
                                "Cleaning"   => "üßπ V·ªá sinh",
                                _            => req.Category.ToString()
                            };
                        }
                        <span class="badge badge-gray">@detailCat</span>
                    </div>

                    <!-- ‚îÄ‚îÄ Th√¥ng tin ch√≠nh ‚îÄ‚îÄ -->
                    <div style="background:var(--bg-card); border:1px solid var(--border); border-radius:10px; padding:16px; margin-bottom:14px;">

                        <!-- BƒêS + Ng∆∞·ªùi y√™u c·∫ßu -->
                        <div style="display:grid; grid-template-columns:1fr 1fr; gap:12px; margin-bottom:12px; padding-bottom:12px; border-bottom:1px dashed var(--border);">
                            <div>
                                <div style="font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:4px;">üè¢ B·∫•t ƒë·ªông s·∫£n</div>
                                <div style="font-weight:600; font-size:13px;">@req.PropertyTitle</div>
                            </div>
                            <div>
                                <div style="font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:4px;">üë§ Ng∆∞·ªùi y√™u c·∫ßu</div>
                                <div style="font-weight:600; font-size:13px;">@req.RequesterName</div>
                            </div>
                        </div>

                        <!-- Ng√†y t·∫°o + Ng√†y h·∫πn + Ng√†y xong -->
                        <div style="display:grid; grid-template-columns:repeat(auto-fit, minmax(140px,1fr)); gap:10px; margin-bottom:12px; padding-bottom:12px; border-bottom:1px dashed var(--border);">
                            <div>
                                <div style="font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:4px;">üìÖ Ng√†y t·∫°o</div>
                                <div style="font-weight:600; font-size:13px;">@req.CreatedAt.ToString("dd/MM/yyyy HH:mm")</div>
                            </div>
                            @if (req.ScheduledDate.HasValue)
                            {
                                <div>
                                    <div style="font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:4px;">üóìÔ∏è Ng√†y h·∫πn</div>
                                    <div style="font-weight:600; font-size:13px; color:#60a5fa;">@req.ScheduledDate.Value.ToString("dd/MM/yyyy")</div>
                                </div>
                            }
                            @if (req.ResolvedAt.HasValue)
                            {
                                <div>
                                    <div style="font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:4px;">‚úÖ Ng√†y xong</div>
                                    <div style="font-weight:600; font-size:13px; color:#34d399;">@req.ResolvedAt.Value.ToString("dd/MM/yyyy HH:mm")</div>
                                </div>
                            }
                        </div>

                        <!-- M√¥ t·∫£ -->
                        <div style="margin-bottom: 0;">
                            <div style="font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; margin-bottom:6px;">üìù M√¥ t·∫£ chi ti·∫øt</div>
                            <div style="font-size:14px; line-height:1.6; white-space:pre-wrap;">@req.Description</div>
                        </div>
                    </div>

                    <!-- ‚îÄ‚îÄ Th√¥ng tin k·ªπ thu·∫≠t vi√™n (khi InProgress) ‚îÄ‚îÄ -->
                    @if (!string.IsNullOrEmpty(req.TechnicianName))
                    {
                        <div style="background:rgba(16,185,129,.1); border:2px solid #10b981; border-radius:10px; padding:14px; margin-bottom:14px;">
                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:10px;">
                                <i data-feather="user-check" style="width:16px; color:#10b981;"></i>
                                <span style="font-size:11px; font-weight:700; text-transform:uppercase; color:#10b981; letter-spacing:.5px;">ƒê√£ k√™u th·ª£</span>
                            </div>
                            <div style="display:grid; grid-template-columns:1fr 1fr; gap:10px;">
                                <div>
                                    <div style="font-size:11px; color:#34d399; margin-bottom:3px;">T√™n k·ªπ thu·∫≠t vi√™n</div>
                                    <div style="font-weight:700; font-size:14px; color:#f1f5f9;">@req.TechnicianName</div>
                                </div>
                                <div>
                                    <div style="font-size:11px; color:#34d399; margin-bottom:3px;">S·ªë ƒëi·ªán tho·∫°i</div>
                                    <div style="font-weight:700; font-size:14px; color:#f1f5f9;">@req.TechnicianPhone</div>
                                </div>
                            </div>
                        </div>
                    }

                    <!-- ‚îÄ‚îÄ L√Ω do t·ª´ ch·ªëi (khi Cancelled) ‚îÄ‚îÄ -->
                    @if (!string.IsNullOrEmpty(req.RejectionReason))
                    {
                        <div style="background:rgba(239,68,68,.1); border:2px solid #ef4444; border-radius:10px; padding:14px; margin-bottom:14px;">
                            <div style="display:flex; align-items:center; gap:8px; margin-bottom:8px;">
                                <i data-feather="x-circle" style="width:16px; color:#ef4444;"></i>
                                <span style="font-size:11px; font-weight:700; text-transform:uppercase; color:#ef4444; letter-spacing:.5px;">L√Ω do t·ª´ ch·ªëi</span>
                            </div>
                            <div style="font-size:14px; line-height:1.6; color:#fca5a5; white-space:pre-wrap;">@req.RejectionReason</div>
                        </div>
                    }

                    <!-- ‚îÄ‚îÄ K·∫øt qu·∫£ x·ª≠ l√Ω (Resolution) ‚îÄ‚îÄ -->
                    @if (!string.IsNullOrEmpty(req.Resolution))
                    {
                        <div style="background:rgba(99,102,241,.1); border:1px solid rgba(99,102,241,.4); border-radius:10px; padding:14px; margin-bottom:14px;">
                            <div style="font-size:11px; color:#818cf8; text-transform:uppercase; letter-spacing:.5px; margin-bottom:6px;">üìã K·∫øt qu·∫£ x·ª≠ l√Ω</div>
                            <div style="font-size:14px; line-height:1.6; white-space:pre-wrap; color:#e2e8f0;">@req.Resolution</div>
                        </div>
                    }

                    <!-- ‚îÄ‚îÄ H√¨nh ·∫£nh ‚îÄ‚îÄ -->
                    @if (!string.IsNullOrEmpty(req.ImageUrls))
                    {
                        var images = req.ImageUrls.Split(',').Select(u => u.Trim()).Where(u => !string.IsNullOrEmpty(u)).ToArray();
                        if (images.Length > 0)
                        {
                            <div>
                                <div style="display:flex; align-items:center; gap:8px; margin-bottom:10px;">
                                    <i data-feather="image" style="width:15px; color:var(--text-muted);"></i>
                                    <span style="font-size:11px; color:var(--text-muted); text-transform:uppercase; letter-spacing:.5px; font-weight:600;">H√¨nh ·∫£nh ƒë√≠nh k√®m (@images.Length ·∫£nh)</span>
                                </div>
                                <div style="display:grid; grid-template-columns:repeat(auto-fill, minmax(110px,1fr)); gap:8px;">
                                    @foreach (var img in images)
                                    {
                                        var trimmedImg = img.Trim();
                                        <div style="position:relative; border-radius:8px; overflow:hidden; padding-top:100%; border:2px solid var(--border); background:var(--bg-hover);">
                                            <a href="@trimmedImg" target="_blank" style="position:absolute; top:0; left:0; width:100%; height:100%;">
                                                <img src="@trimmedImg" alt="·∫¢nh ƒë√≠nh k√®m"
                                                     style="width:100%; height:100%; object-fit:cover; transition:opacity .2s;"
                                                     onerror="this.style.display='none'; this.parentElement.innerHTML += '<div style=\'display:flex;align-items:center;justify-content:center;height:100%;color:var(--text-muted);font-size:11px;\'>L·ªói t·∫£i ·∫£nh</div>';" />
                                            </a>
                                        </div>
                                    }
                                </div>
                            </div>
                        }
                    }

                </div><!-- end modal-body -->

                <div class="modal-footer">
                    @if (req.Status.ToString() == "Open")
                    {
                        <button class="btn btn-danger" onclick="closeModal('detailModal-@req.Id'); openRejectModal(@req.Id, '@Html.Raw(req.Title.Replace("'", "\\'"))')">
                            <i data-feather="x-circle" style="width:14px;"></i> T·ª´ ch·ªëi
                        </button>
                        <button class="btn btn-success" onclick="closeModal('detailModal-@req.Id'); openApproveModal(@req.Id, '@Html.Raw(req.Title.Replace("'", "\\'"))')">
                            <i data-feather="user-check" style="width:14px;"></i> ƒê√£ k√™u th·ª£
                        </button>
                    }
                    @if (req.Status.ToString() == "InProgress")
                    {
                        <button class="btn btn-success" onclick="closeModal('detailModal-@req.Id'); openCompleteModal(@req.Id, '@Html.Raw(req.Title.Replace("'", "\\'"))')">
                            <i data-feather="check-circle" style="width:14px;"></i> Ho√†n th√†nh
                        </button>
                    }
                    <button class="btn btn-secondary" onclick="closeModal('detailModal-@req.Id')">ƒê√≥ng</button>
                </div>
            </div>
        </div>
    }
}

<!-- ACTION MODALS (using forms) -->
<div id="approveModal" class="modal-overlay" style="display: none;">
    <div class="modal">
        <form method="post" asp-page-handler="Approve" id="approveForm">
            <div class="modal-header">
                <span class="modal-title">Ph√™ duy·ªát y√™u c·∫ßu b·∫£o tr√¨</span>
                <button type="button" class="modal-close btn btn-ghost btn-sm btn-icon" onclick="closeModal('approveModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-primary); margin-bottom: 16px;">
                    B·∫°n ƒëang ph√™ duy·ªát y√™u c·∫ßu: <strong id="approveRequestTitle"></strong>
                </p>
                <input type="hidden" name="requestId" id="approveRequestId" />
                <div class="form-group" style="margin-bottom: 16px;">
                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">T√™n k·ªπ thu·∫≠t vi√™n / Th·ª£ s·ª≠a *</label>
                    <input name="technicianName" class="form-control" placeholder="Nh·∫≠p t√™n th·ª£..." required style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;" />
                </div>
                <div class="form-group">
                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">S·ªë ƒëi·ªán tho·∫°i th·ª£ *</label>
                    <input name="technicianPhone" class="form-control" placeholder="Nh·∫≠p s·ªë ƒëi·ªán tho·∫°i..." required style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;" />
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('approveModal')">H·ªßy</button>
                <button type="button" class="btn btn-success" onclick="confirmApprove()">‚úì Ph√™ duy·ªát</button>
            </div>
        </form>
    </div>
</div>

<div id="rejectModal" class="modal-overlay" style="display: none;">
    <div class="modal">
        <form method="post" asp-page-handler="Reject" id="rejectForm">
            <div class="modal-header">
                <span class="modal-title">T·ª´ ch·ªëi y√™u c·∫ßu b·∫£o tr√¨</span>
                <button type="button" class="modal-close btn btn-ghost btn-sm btn-icon" onclick="closeModal('rejectModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-primary); margin-bottom: 16px;">
                    B·∫°n ƒëang t·ª´ ch·ªëi y√™u c·∫ßu: <strong id="rejectRequestTitle"></strong>
                </p>
                <input type="hidden" name="requestId" id="rejectRequestId" />
                <div class="form-group">
                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">L√Ω do t·ª´ ch·ªëi *</label>
                    <textarea name="reason" class="form-control" rows="4" placeholder="Nh·∫≠p l√Ω do t·ª´ ch·ªëi y√™u c·∫ßu n√†y..." required style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('rejectModal')">H·ªßy</button>
                <button type="button" class="btn btn-danger" onclick="confirmReject()">T·ª´ ch·ªëi</button>
            </div>
        </form>
    </div>
</div>

<div id="completeModal" class="modal-overlay" style="display: none;">
    <div class="modal">
        <form method="post" asp-page-handler="Complete" id="completeForm">
            <div class="modal-header">
                <span class="modal-title">Ho√†n th√†nh y√™u c·∫ßu b·∫£o tr√¨</span>
                <button type="button" class="modal-close btn btn-ghost btn-sm btn-icon" onclick="closeModal('completeModal')">‚úï</button>
            </div>
            <div class="modal-body">
                <p style="color: var(--text-primary); margin-bottom: 16px;">
                    B·∫°n ƒëang ho√†n th√†nh y√™u c·∫ßu: <strong id="completeRequestTitle"></strong>
                </p>
                <input type="hidden" name="requestId" id="completeRequestId" />
                <div class="form-group">
                    <label class="form-label" style="display: block; margin-bottom: 8px; font-weight: 500;">K·∫øt qu·∫£ x·ª≠ l√Ω *</label>
                    <textarea name="resolution" class="form-control" rows="4" placeholder="M√¥ t·∫£ chi ti·∫øt nh·ªØng g√¨ ƒë√£ s·ª≠a ch·ªØa..." required style="width: 100%; padding: 8px 12px; border: 1px solid var(--border); border-radius: 6px;"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeModal('completeModal')">H·ªßy</button>
                <button type="button" class="btn btn-success" onclick="confirmCompleteSubmit()">‚úì Ho√†n th√†nh</button>
            </div>
        </form>
    </div>
</div>

@section Scripts {
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
        $(document).ready(function() {
            @if(TempData["SuccessMessage"] != null)
            {
                <text>
                Swal.fire({
                    icon: 'success',
                    title: 'Th√†nh c√¥ng',
                    text: '@Html.Raw(TempData["SuccessMessage"])',
                    confirmButtonColor: '#3085d6'
                });
                </text>
            }
            @if(TempData["ErrorMessage"] != null)
            {
                <text>
                Swal.fire({
                    icon: 'error',
                    title: 'L·ªói',
                    text: '@Html.Raw(TempData["ErrorMessage"])',
                    confirmButtonColor: '#d33'
                });
                </text>
            }
        });

        function filterRequests() {
            var search = document.getElementById('searchInput').value.toLowerCase();
            var activeStatus = document.querySelector('.filter-btn.btn-primary').getAttribute('data-status');
            
            var rows = document.querySelectorAll('.maintenance-row');
            rows.forEach(function(row) {
                var text = row.getAttribute('data-search');
                var status = row.getAttribute('data-status');
                
                var matchSearch = search === "" || text.includes(search);
                var matchStatus = activeStatus === "All" || status === activeStatus;
                
                if (matchSearch && matchStatus) {
                    row.style.display = '';
                } else {
                    row.style.display = 'none';
                }
            });
        }

        function setStatusFilter(status, btn) {
            document.querySelectorAll('.filter-btn').forEach(function(b) {
                b.classList.remove('btn-primary');
                b.classList.add('btn-ghost');
            });
            btn.classList.remove('btn-ghost');
            btn.classList.add('btn-primary');
            filterRequests();
        }

        function openDetailModal(id) {
            document.getElementById('detailModal-' + id).style.display = 'flex';
        }

        function closeModal(id) {
            document.getElementById(id).style.display = 'none';
        }

        function openApproveModal(id, title) {
            document.getElementById('approveRequestId').value = id;
            document.getElementById('approveRequestTitle').textContent = title;
            document.getElementById('approveModal').style.display = 'flex';
        }

        function openRejectModal(id, title) {
            document.getElementById('rejectRequestId').value = id;
            document.getElementById('rejectRequestTitle').textContent = title;
            document.getElementById('rejectModal').style.display = 'flex';
        }


        
        function confirmApprove() {
            var form = document.getElementById('approveForm');
            if(form.reportValidity()) {
                Swal.fire({
                    title: 'B·∫°n c√≥ ch·∫Øc ch·∫Øn?',
                    text: "S·∫Ω ph√™ duy·ªát v√† thay ƒë·ªïi tr·∫°ng th√°i th√†nh ƒêang x·ª≠ l√Ω",
                    icon: 'question',
                    showCancelButton: true,
                    confirmButtonColor: '#10b981',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'ƒê·ªìng √Ω',
                    cancelButtonText: 'H·ªßy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            }
        }
        
        function confirmReject() {
            var form = document.getElementById('rejectForm');
            if(form.reportValidity()) {
                Swal.fire({
                    title: 'X√°c nh·∫≠n t·ª´ ch·ªëi?',
                    text: "Y√™u c·∫ßu n√†y s·∫Ω b·ªã h·ªßy b·ªè vƒ©nh vi·ªÖn",
                    icon: 'warning',
                    showCancelButton: true,
                    confirmButtonColor: '#ef4444',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'T·ª´ ch·ªëi',
                    cancelButtonText: 'H·ªßy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            }
        }
        
        function openCompleteModal(id, title) {
            document.getElementById('completeRequestId').value = id;
            document.getElementById('completeRequestTitle').textContent = title;
            document.getElementById('completeModal').style.display = 'flex';
        }

        function confirmCompleteSubmit() {
            var form = document.getElementById('completeForm');
            if(form.reportValidity()) {
                Swal.fire({
                    title: 'X√°c nh·∫≠n ho√†n th√†nh?',
                    text: "ƒê√°nh d·∫•u y√™u c·∫ßu n√†y ƒë√£ ƒë∆∞·ª£c gi·∫£i quy·∫øt xong",
                    icon: 'success',
                    showCancelButton: true,
                    confirmButtonColor: '#10b981',
                    cancelButtonColor: '#6b7280',
                    confirmButtonText: 'Ho√†n th√†nh',
                    cancelButtonText: 'H·ªßy'
                }).then((result) => {
                    if (result.isConfirmed) {
                        form.submit();
                    }
                });
            }
        }
    </script>
}
